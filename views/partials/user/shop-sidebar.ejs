<link rel="stylesheet" href="/styles/user/sidebar.css">

<!-- SIDEBAR -->
<aside class="sidebar">

  <!-- HEADER -->
  <div class="filter-section">
    <h3>Filter By</h3>
    <div class="filter-buttons">
      <button class="filter-btn active" onclick="applyFilters()">Apply</button>
      <button class="filter-btn" onclick="resetFilters()">Reset</button>
    </div>
  </div>

  <!-- CATEGORY -->
  <div class="filter-section">
    <h3>Category</h3>
    <div class="checkbox-group">
      <% categories.forEach(cat => { %>
        <label>
          <input
            type="checkbox"
            name="category"
            value="<%= cat._id %>"
            <%= filters.category == cat._id ? "checked" : "" %>
          >
          <%= cat.name %>
        </label>
      <% }) %>
    </div>
  </div>

  <!-- PRICE -->
  <div class="filter-section">
    <label>
      Price: ₹<span id="priceValue">
        <%= filters.maxPrice
          ? Number(filters.maxPrice).toLocaleString("en-IN")
          : "Any" %>
      </span>
    </label>

    <div class="range-slider-single">
      <span>₹1,00,000</span>
      <input
        type="range"
        id="priceRange"
        min="0"
        max="1000000"
        value="<%= filters.maxPrice || 1000000 %>"
      >
      <span>₹10,00,000</span>
    </div>
  </div>

  <!-- BRAND -->
  <div class="filter-section">
    <h3>Brand</h3>
    <div class="checkbox-group">
      <% brands.forEach(b => { %>
        <label>
          <input
            type="radio"
            name="brand"
            value="<%= b._id %>"
            <%= filters.brand == b._id ? "checked" : "" %>
          >
          <%= b.brandName %>
        </label>
      <% }) %>
    </div>
  </div>

</aside>

<script>
document.addEventListener("DOMContentLoaded", function () {

  const slider = document.getElementById("priceRange");
  const label = document.getElementById("priceValue");

  if (!slider || !label) return;

  function updateSlider() {
    const value = slider.value;
    const min = slider.min;
    const max = slider.max;
    const percent = ((value - min) / (max - min)) * 100;

    slider.style.background = `
      linear-gradient(to right,
        #e74c3c 0%,
        #e74c3c ${percent}%,
        #000 ${percent}%,
        #000 100%)
    `;

    label.innerText =
      value == max
        ? "Any"
        : Number(value).toLocaleString("en-IN");
  }

  window.applyFilters = function () {
    const url = new URL(window.location.href);

    const categories = Array.from(
      document.querySelectorAll('input[name="category"]:checked')
    ).map(input => input.value);

    if (categories.length) {
     url.searchParams.set("category", categories.join(","));
    } else {
      url.searchParams.delete("category");
    }


    // BRAND
    const brand = document.querySelector('input[name="brand"]:checked');
    if (brand) url.searchParams.set("brand", brand.value);
    else url.searchParams.delete("brand");

    // PRICE — always send slider value
    url.searchParams.set("maxPrice", slider.value);
    
    // SEARCH (from shop page)
    const searchInput = document.querySelector(".search-input");
    if (searchInput && searchInput.value.trim() !== "") {
      url.searchParams.set("search", searchInput.value.trim());
    } else {
      url.searchParams.delete("search");
    }

    url.searchParams.set("page", 1);
    window.location.href = url.toString();
  };

  window.resetFilters = function () {
    window.location.href = "/shop";
  };

  slider.addEventListener("input", updateSlider);
  updateSlider();
});
</script>
