<aside class="sidebar">

  <!-- FILTER BUTTONS -->
  <div class="filter-section">
    <div class="filter-buttons">
      <button class="filter-btn active" onclick="applyFilters()">Apply Filters</button>
      <button class="filter-btn" onclick="resetFilters()">Reset</button>
    </div>
  </div>

  <!-- CATEGORY -->
  <div class="filter-section">
    <h3>Categories</h3>
    <div class="checkbox-group">
      <% categories.forEach(cat=> { %>
        <label>
          <input type="checkbox" name="category" value="<%= cat._id %>" <%=filters.category &&
            filters.category.split(',').includes(cat._id.toString()) ? "checked" : "" %>
          >
          <%= cat.name %>
        </label>
        <% }) %>
    </div>
  </div>

  <!-- BRAND -->
  <div class="filter-section">
    <h3>Brands</h3>
    <div class="checkbox-group">
      <% brands.forEach(b=> { %>
        <label>
          <input type="checkbox" name="brand" value="<%= b._id %>" <%=filters.brand &&
            filters.brand.split(',').includes(b._id.toString()) ? "checked" : "" %>
          >
          <%= b.brandName %>
        </label>
        <% }) %>
    </div>
  </div>

  <!-- PRICE slider -->
  <div class="filter-section">
    <h3>Price Range</h3>
    <div class="range-slider-single">
      <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
        <span style="color: #fff; font-size: 13px;">Max Range:</span>
        <span id="priceValue" style="color: var(--accent-gold); font-weight: 600;">
          ₹<%= filters.maxPrice ? Number(filters.maxPrice).toLocaleString("en-IN") : "Any" %>
        </span>
      </div>
      <input type="range" id="priceRange" min="0" max="1000000" step="5000" value="<%= filters.maxPrice || 1000000 %>">
      <div style="display: flex; justify-content: space-between; margin-top: 5px;">
        <span>₹0</span>
        <span>₹10L+</span>
      </div>
    </div>
  </div>

</aside>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const slider = document.getElementById("priceRange");
    const label = document.getElementById("priceValue");

    if (!slider || !label) return;

    function updateSlider() {
      const value = slider.value;
      const percent = (value / slider.max) * 100;

      slider.style.background = `linear-gradient(to right, var(--accent-gold) 0%, var(--accent-gold) ${percent}%, #333 ${percent}%, #333 100%)`;

      label.innerText = value == slider.max ? "Any" : "₹" + Number(value).toLocaleString("en-IN");
    }

    window.applyFilters = function () {
      const url = new URL(window.location.href);

      // CATEGORIES
      const categories = Array.from(document.querySelectorAll('input[name="category"]:checked'))
        .map(input => input.value);
      if (categories.length) url.searchParams.set("category", categories.join(","));
      else url.searchParams.delete("category");

      // BRANDS
      const brands = Array.from(document.querySelectorAll('input[name="brand"]:checked'))
        .map(input => input.value);
      if (brands.length) url.searchParams.set("brand", brands.join(","));
      else url.searchParams.delete("brand");

      // PRICE
      url.searchParams.set("maxPrice", slider.value);

      // SEARCH
      const searchInput = document.querySelector(".search-input");
      if (searchInput && searchInput.value.trim() !== "") {
        url.searchParams.set("search", searchInput.value.trim());
      }

      url.searchParams.set("page", 1);
      window.location.href = url.toString();
    };

    window.resetFilters = function () {
      window.location.href = "/shop";
    };

    slider.addEventListener("input", updateSlider);
    updateSlider();
  });
</script>