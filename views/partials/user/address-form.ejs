<section class="address-page" id="addAddressView" style="display:none">

  <a href="#" class="back-link" id="btnBackToList">
    <i class="fa-solid fa-arrow-left"></i>
    <%= backText || "Back to Addresses" %>
  </a>

  <div class="address-form-wrapper">
    <h2 id="addressFormTitle">
      Add New <span>Address</span>
    </h2>

    <form id="addNewAddressForm">

      <div class="form-group">
        <label>Address Type</label>
        <select name="addressType">
          <option value="Home">Home</option>
          <option value="Work">Work</option>
          <option value="Other">Other</option>
        </select>
        <div id="error-addressType" class="error-message"></div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Full Name *</label>
          <input type="text" name="name">
          <div id="error-name" class="error-message"></div>
        </div>
        <div class="form-group">
          <label>Phone Number *</label>
          <input type="tel" name="phone">
          <div id="error-phone" class="error-message"></div>
        </div>
      </div>

      <div class="form-group">
        <label>Address Line 1 *</label>
        <input type="text" name="line1">
        <div id="error-line1" class="error-message"></div>
      </div>

      <div class="form-group">
        <label>Address Line 2</label>
        <input type="text" name="line2">
        <div id="error-line2" class="error-message"></div>
      </div>

      <div class="form-row-triple">
        <div class="form-group">
          <label>City *</label>
          <input type="text" name="city">
          <div id="error-city" class="error-message"></div>
        </div>
        <div class="form-group">
          <label>State *</label>
          <input type="text" name="state">
          <div id="error-state" class="error-message"></div>
        </div>
        <div class="form-group">
          <label>Pincode *</label>
          <input type="text" name="pin_code">
          <div id="error-pin_code" class="error-message"></div>
        </div>
      </div>

      <div class="checkbox-group">
        <input type="checkbox" id="setAsDefault" name="isDefault">
        <label for="setAsDefault">Set as default address</label>
      </div>

      <div class="form-actions">
        <button type="button" class="cancel-btn" id="btnCancelAdd">
          Cancel
        </button>
        <button type="submit" class="submit-btn" id="btnSubmitAddress">
          <%= submitText || "Add Address" %>
        </button>
      </div>

    </form>
  </div>

</section>

<script>
  function validateAddressForm() {
    let isValid = true;
    const form = document.getElementById("addNewAddressForm");
    const formData = new FormData(form);

    const errors = {
      name: "",
      phone: "",
      line1: "",
      city: "",
      state: "",
      pin_code: ""
    };

    // Reset error messages
    document.querySelectorAll(".error-message").forEach(el => el.textContent = "");

    // Name: Required, 3-50 characters
    const name = formData.get("name").trim();
    if (!name) {
      errors.name = "Full name is required";
      isValid = false;
    } else if (!/^[a-zA-Z\s.-]{3,50}$/.test(name)) {
      errors.name = "Name should be 3-50 characters (letters, spaces, dots, and hyphens only)";
      isValid = false;
    }

    // Phone: Required, 10 digits
    const phone = formData.get("phone").trim();
    if (!phone) {
      errors.phone = "Phone number is required";
      isValid = false;
    } else if (!/^[6-9]\d{9}$/.test(phone)) {
      errors.phone = "Enter a valid 10-digit phone number";
      isValid = false;
    }

    // Line 1: Required
    const line1 = formData.get("line1").trim();
    if (!line1) {
      errors.line1 = "Address line 1 is required";
      isValid = false;
    }

    // City: Required, letters
    const city = formData.get("city").trim();
    if (!city) {
      errors.city = "City is required";
      isValid = false;
    } else if (!/^[a-zA-Z\s]+$/.test(city)) {
      errors.city = "Enter a valid city name";
      isValid = false;
    }

    // State: Required, letters
    const state = formData.get("state").trim();
    if (!state) {
      errors.state = "State is required";
      isValid = false;
    } else if (!/^[a-zA-Z\s]+$/.test(state)) {
      errors.state = "Enter a valid state name";
      isValid = false;
    }

    // Pincode: Required, 6 digits
    const pin = formData.get("pin_code").trim();
    if (!pin) {
      errors.pin_code = "Pincode is required";
      isValid = false;
    } else if (!/^\d{6}$/.test(pin)) {
      errors.pin_code = "Enter a valid 6-digit pincode";
      isValid = false;
    }

    // Display errors
    for (const key in errors) {
      const errorDiv = document.getElementById(`error-${key}`);
      if (errorDiv && errors[key]) {
        errorDiv.textContent = errors[key];
      }
    }

    return isValid;
  }
</script>