<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- SweetAlert2 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.10.0/sweetalert2.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.10.0/sweetalert2.min.css">

  <!-- Page CSS -->
  <link rel="stylesheet" href="/styles/user/header.css">
  <link rel="stylesheet" href="/styles/user/order-success.css">

  <style>
    /* Hide page content initially */
    .main-content {
      display: none;
    }

    .ordered-items-section {
      margin-top: 40px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 8px;
    }

    .ordered-items-section h3 {
      margin-bottom: 20px;
      font-size: 20px;
      color: #333;
    }

    .items-list {
      margin-bottom: 20px;
    }

    .item-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: white;
      margin-bottom: 10px;
      border-radius: 6px;
      border-left: 4px solid #d4af37;
    }

    .item-details h5 {
      margin: 0 0 8px 0;
      color: #333;
      font-weight: 600;
    }

    .item-details p {
      margin: 4px 0;
      color: #666;
      font-size: 14px;
    }

    .item-subtotal {
      font-weight: 700;
      font-size: 16px;
      color: #d4af37;
    }

    .price-breakdown {
      margin-top: 20px;
      padding: 15px;
      background: white;
      border-radius: 6px;
    }

    .breakdown-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
      color: #333;
    }

    .breakdown-row.total {
      border-bottom: 2px solid #d4af37;
      font-weight: 700;
      font-size: 16px;
      color: #d4af37;
      padding-top: 15px;
    }
  </style>
</head>

<body>

  <!-- ================= HEADER ================= -->
  <%- include("../partials/user/header") %>

    <!-- ================= MAIN ================= -->
    <main class="main-content">

      <section class="success-container">

        <h1>Order Successful! âœ“</h1>
        <p class="subtitle">
          Thank you for your purchase. Your order has been confirmed and will be processed shortly.
        </p>

        <!-- ORDER DETAILS -->
        <div class="order-details">

          <div class="detail-item">
            <span class="detail-label">Order Number</span>
            <span class="detail-value order-number">
              <%= order.orderId %>
            </span>
          </div>

          <div class="detail-item">
            <span class="detail-label">Order Date</span>
            <span class="detail-value">
              <%= new Date(order.createdAt).toLocaleDateString("en-IN", { year: "numeric" , month: "long" ,
                day: "numeric" }) %>
            </span>
          </div>

          <div class="detail-item">
            <span class="detail-label">Order Total</span>
            <span class="detail-value">
              â‚¹ <%= order.finalAmount.toLocaleString("en-IN") %>
            </span>
          </div>

          <div class="detail-item">
            <span class="detail-label">Delivery Address</span>
            <span class="detail-value">
              <strong>
                <%= order.address.name %>
              </strong><br>
              <%= order.address.line1 %>
                <% if (order.address.line2) { %>
                  , <%= order.address.line2 %>
                    <% } %><br>
                      <%= order.address.city %>, <%= order.address.state %> - <%= order.address.pincode %><br>
                            <strong>Phone:</strong>
                            <%= order.address.phone %>
            </span>
          </div>

          <div class="detail-item">
            <span class="detail-label">Estimated Delivery</span>
            <span class="detail-value">
              <%= new Date( new Date(order.createdAt).getTime() + 4 * 24 * 60 * 60 * 1000 ).toLocaleDateString("en-IN",
                { year: "numeric" , month: "long" , day: "numeric" }) %>
            </span>
          </div>

          <div class="detail-item">
            <span class="detail-label">Payment Method</span>
            <span class="detail-value">
              <strong>
                <%= order.paymentMethod %>
              </strong> (<%= order.paymentStatus %>)
            </span>
          </div>

        </div>

        <!-- ORDERED ITEMS -->
        <div class="ordered-items-section">
          <h3>ðŸ“¦ Order Items (<%= order.orderedItems.length %>)</h3>
          <div class="items-list">
            <% order.orderedItems.forEach(item=> { %>
              <div class="item-row">
                <div class="item-details">
                  <h5>
                    <%= item.product.productName %>
                  </h5>
                  <p><strong>Quantity:</strong>
                    <%= item.quantity %>
                  </p>
                  <p><strong>Price per Unit:</strong> â‚¹ <%= item.price.toLocaleString("en-IN") %>
                  </p>
                  <% if (item.appliedOffer) { %>
                    <div class="offer-badge"
                      style="font-size: 8px; padding: 2px 8px; display: inline-block; margin-top: 4px;">
                      <%= item.appliedOffer.discountValue %>% OFF
                    </div>
                    <% } %>
                </div>
                <div class="item-subtotal">
                  â‚¹ <%= (item.price * item.quantity).toLocaleString("en-IN") %>
                </div>
              </div>
              <% }) %>
          </div>

          <div class="price-breakdown">
            <div class="breakdown-row">
              <span>Subtotal</span>
              <span>â‚¹ <%= order.totalPrice.toLocaleString("en-IN") %></span>
            </div>
            <% if (order.discount> 0) { %>
              <div class="breakdown-row">
                <span>Discount Applied</span>
                <span style="color: #28a745;">- â‚¹ <%= order.discount.toLocaleString("en-IN") %></span>
              </div>
              <% } %>
                <div class="breakdown-row total">
                  <span>Total Amount</span>
                  <span>â‚¹ <%= order.finalAmount.toLocaleString("en-IN") %></span>
                </div>
          </div>
        </div>

        <!-- ACTION BUTTONS -->
        <div class="button-group" style="margin-top: 30px; display: flex; gap: 15px; justify-content: center;">
          <button class="btn btn-primary" onclick="window.location.href='/shop'"
            style="padding: 12px 30px; background: #d4af37; color: #000; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 16px;">
            Continue Shopping
          </button>

          <button class="btn btn-secondary" onclick="window.location.href='/profile/orders'"
            style="padding: 12px 30px; background: #333; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 16px;">
            View My Orders
          </button>
        </div>

      </section>

    </main>

    <!-- ================= FOOTER ================= -->
    <%- include("../partials/user/footer") %>
      <script>
        document.addEventListener('DOMContentLoaded', function () {
          const nav = document.querySelector('nav');
          if (!nav) return;
          nav.classList.add('glass-nav');
        });
      </script>

      <!-- ================= SWEETALERT ================= -->
      <script>
        // Show success alert immediately
        document.addEventListener("DOMContentLoaded", function () {
          Swal.fire({
            icon: "success",
            title: "Order Placed Successfully!",
            html: `
        <p style="font-size: 16px; margin: 15px 0;">
          <strong>Order ID: <%= order.orderId %></strong><br><br>
          Your order has been confirmed and will be processed shortly.
        </p>
      `,
            confirmButtonText: "View Order Details",
            confirmButtonColor: "#d4af37",
            allowOutsideClick: false,
            allowEscapeKey: false,
            width: 500
          }).then((result) => {
            // Show page content after alert is confirmed
            if (result.isConfirmed) {
              document.querySelector('.main-content').style.display = 'flex';
            }
          });
        });
      </script>

</body>

</html>